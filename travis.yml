dist: trusty

sudo: required

language: cpp

services:
  - docker

env:
  global:
    - GITHUB_REPO=pmem/libpmemobj-cpp
    - DOCKERHUB_REPO=pmem/libpmemobj-cpp
  matrix:
    - TYPE=debug OS=fedora OS_VER=32 PUSH_IMAGE=1
    - TYPE=debug OS=ubuntu OS_VER=20.04 PUSH_IMAGE=1 CHECK_CPP_STYLE=1
    - TYPE=release OS=fedora OS_VER=32 AUTO_DOC_UPDATE=1
    - TYPE=release OS=ubuntu OS_VER=20.04
    - TYPE=valgrind OS=ubuntu OS_VER=20.04
    - TYPE=memcheck_drd OS=ubuntu OS_VER=20.04
    - TYPE=package OS=fedora OS_VER=32
    - TYPE=package OS=ubuntu OS_VER=20.04
    - TYPE=coverage OS=ubuntu OS_VER=20.04
    - TYPE=coverity OS=ubuntu OS_VER=20.04

before_install:
  - echo $TRAVIS_COMMIT_RANGE
  - export HOST_WORKDIR=`pwd`
  - cd utils/docker
  - ./pull-or-rebuild-image.sh rebuild

script:
  - ./build.sh

after_success:
  - source ./set-vars.sh
  - if [[ -f $CI_FILE_PUSH_IMAGE_TO_REPO ]]; then ./images/push-image.sh $OS-$OS_VER; fi
